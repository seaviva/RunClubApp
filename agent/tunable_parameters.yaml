# Tunable Parameters Registry
# 
# This file documents parameters the agent can modify.
# - numeric_tuning: Parameters that can be auto-applied
# - structural_changes: Categories that require user approval
#
# Each parameter includes:
# - file: Source file path
# - parameter: Parameter name/path
# - current: Current value
# - range: [min, max] acceptable range
# - description: What this parameter does
# - impact: What changing it affects

# =============================================================================
# NUMERIC TUNING (Auto-Apply Allowed)
# =============================================================================

numeric_tuning:

  # ---------------------------------------------------------------------------
  # Tier Specifications - Tempo Tolerance
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.easy.tempoToleranceBPM
    current: 15
    range: [10, 20]
    description: "BPM tolerance for Easy tier tempo matching"
    impact: "Lower = stricter tempo matching; Higher = more song variety"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.moderate.tempoToleranceBPM
    current: 12
    range: [8, 16]
    description: "BPM tolerance for Moderate tier"
    impact: "Moderate tier is transitional; balance strictness vs flexibility"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.strong.tempoToleranceBPM
    current: 10
    range: [6, 14]
    description: "BPM tolerance for Strong tier"
    impact: "Strong is sustained intensity; tighter tolerance keeps energy consistent"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.hard.tempoToleranceBPM
    current: 8
    range: [5, 12]
    description: "BPM tolerance for Hard tier"
    impact: "Hard efforts need correct tempo to feel hard"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.max.tempoToleranceBPM
    current: 6
    range: [4, 10]
    description: "BPM tolerance for Max tier"
    impact: "Max is peak intensity; strictest tempo matching"

  # ---------------------------------------------------------------------------
  # Tier Specifications - Tempo Fit Minimum
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.easy.tempoFitMinimum
    current: 0.35
    range: [0.25, 0.50]
    description: "Minimum tempoFit score to consider a track for Easy tier"
    impact: "Lower = more tracks qualify but may not fit well"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.moderate.tempoFitMinimum
    current: 0.42
    range: [0.30, 0.55]
    description: "Minimum tempoFit score for Moderate tier"
    impact: "Gate for Moderate tier quality"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.strong.tempoFitMinimum
    current: 0.50
    range: [0.40, 0.65]
    description: "Minimum tempoFit score for Strong tier"
    impact: "Gate for Strong tier quality"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.hard.tempoFitMinimum
    current: 0.55
    range: [0.45, 0.70]
    description: "Minimum tempoFit score for Hard tier"
    impact: "Gate for Hard tier quality"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.max.tempoFitMinimum
    current: 0.60
    range: [0.50, 0.75]
    description: "Minimum tempoFit score for Max tier"
    impact: "Gate for Max tier quality - strictest"

  # ---------------------------------------------------------------------------
  # Tier Specifications - Scoring Weights
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.easy.weights.tempo
    current: 0.65
    range: [0.50, 0.80]
    description: "Weight of tempo in Easy tier effort index calculation"
    impact: "Higher = tempo matters more than energy/danceability for Easy"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.easy.weights.energy
    current: 0.25
    range: [0.15, 0.35]
    description: "Weight of energy in Easy tier effort index"
    impact: "How much energy affects Easy tier scoring"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.strong.weights.tempo
    current: 0.60
    range: [0.45, 0.75]
    description: "Weight of tempo in Strong tier"
    impact: "Balance between tempo and energy for sustained intensity"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.hard.weights.energy
    current: 0.32
    range: [0.25, 0.40]
    description: "Weight of energy in Hard tier"
    impact: "Energy matters more for hard efforts"

  # ---------------------------------------------------------------------------
  # Tempo Windows (BPM Ranges)
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tempoWindow.easy.min
    current: 150
    range: [140, 160]
    description: "Minimum BPM for Easy tier tempo window"
    impact: "Lower bound of acceptable tempo for easy efforts"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tempoWindow.easy.max
    current: 165
    range: [155, 175]
    description: "Maximum BPM for Easy tier tempo window"
    impact: "Upper bound of acceptable tempo for easy efforts"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tempoWindow.hard.min
    current: 168
    range: [160, 175]
    description: "Minimum BPM for Hard tier"
    impact: "Lower bound for hard effort tempo"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tempoWindow.hard.max
    current: 186
    range: [180, 195]
    description: "Maximum BPM for Hard tier"
    impact: "Upper bound for hard effort tempo"

  # ---------------------------------------------------------------------------
  # Energy Thresholds
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.easy.energyCapEasy
    current: 0.70
    range: [0.60, 0.80]
    description: "Energy cap for Easy tier - tracks above this get penalized"
    impact: "Keeps easy slots actually easy"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.moderate.energyMin
    current: 0.35
    range: [0.25, 0.45]
    description: "Minimum energy for Moderate tier"
    impact: "Ensures moderate slots have some energy"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: tierSpec.hard.energyMin
    current: 0.55
    range: [0.45, 0.65]
    description: "Minimum energy for Hard tier"
    impact: "Ensures hard slots feel intense"

  # ---------------------------------------------------------------------------
  # Bonus Weights
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: bonus.recencyWeight
    current: 0.10
    range: [0.05, 0.20]
    description: "Weight of recency bonus in scoring"
    impact: "How much to favor tracks not used recently"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: bonus.artistSpacingWeight
    current: 0.16
    range: [0.08, 0.25]
    description: "Weight of artist spacing bonus"
    impact: "How much to favor artist variety"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: bonus.diversityWeight
    current: 0.10
    range: [0.05, 0.20]
    description: "Weight of diversity bonus (genre/decade variety)"
    impact: "How much to favor musical diversity"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: bonus.genreAffinityWeight
    current: 0.08
    range: [0.04, 0.15]
    description: "Weight of genre affinity bonus"
    impact: "How much to favor tracks matching selected genres"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: bonus.rediscoveryBias
    current: 0.05
    range: [0.02, 0.12]
    description: "Bias toward rediscovery tracks"
    impact: "Helps achieve 50% rediscovery target"

  # ---------------------------------------------------------------------------
  # Selection Parameters
  # ---------------------------------------------------------------------------
  
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: selection.topK.easy
    current: 25
    range: [15, 40]
    description: "Top-K candidates to sample from for Easy slots"
    impact: "Higher = more randomness in Easy slot selection"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: selection.topK.moderate
    current: 15
    range: [10, 25]
    description: "Top-K candidates for Moderate slots"
    impact: "Balance between quality and variety"
    
  - file: RunClub/Features/Generation/LocalGenerator.swift
    parameter: selection.topK.hard
    current: 8
    range: [5, 15]
    description: "Top-K candidates for Hard/Max slots"
    impact: "Tighter selection for high-intensity slots"

# =============================================================================
# STRUCTURAL CHANGES (Require User Approval)
# =============================================================================

structural_changes:
  - category: "New scoring component"
    description: "Adding a new factor to the effort index or scoring formula"
    example: "Adding speechiness for rap genre handling"
    
  - category: "Algorithm flow change"
    description: "Modifying the selection loop, relaxation order, or control flow"
    example: "Changing when neighbor broadening is triggered"
    
  - category: "New tier or template"
    description: "Adding a new effort tier or run template type"
    example: "Adding a 'sprint' tier above max"
    
  - category: "Pool building logic"
    description: "Changing how candidates are filtered or sourced"
    example: "Modifying 10-day lockout logic"
    
  - category: "Duration planning"
    description: "Changing segment duration targets or bucketing"
    example: "Adjusting warmup/cooldown percentages"
    
  - category: "New relaxation strategy"
    description: "Adding new ways to handle thin pools"
    example: "Breaking decade filters before genre filters"

# =============================================================================
# METADATA
# =============================================================================

metadata:
  last_updated: "2024-12-08"
  version: "1.0"
  notes: |
    This registry is used by the agent to:
    1. Know what parameters it can safely auto-tune
    2. Stay within reasonable ranges
    3. Understand the impact of changes
    
    When adding new parameters:
    - Include the exact file path
    - Specify current value and acceptable range
    - Describe what the parameter does and what changing it affects
    
    The agent will:
    - Auto-apply numeric tuning within specified ranges
    - Request approval for any structural changes
    - Validate changes compile before committing
