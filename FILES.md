## RunClub App — File Overview

Brief descriptions of the main files and directories to help navigate the codebase.

Key highlights of the current architecture:
- Feature-first structure under `RunClub/Features` for high cohesion and faster navigation.
- Minutes-based run lengths (default 30). No short/medium/long categories; generator targets requested minutes within ±2 minutes.
- Spotify auth is via Juky (web-based); native PKCE removed.
- Calendar/schedule and HealthKit workout integration removed. Run sessions are CoreLocation-based.

### Root
- `FILES.md`: This document; high-level file inventory and purposes.
- `RunClub/`: Primary app source, resources, and assets.
- `RunClub.xcodeproj/`: Xcode project configuration and workspace files.
- `RunClubTests/`: Unit test target sources.
- `RunClubUITests/`: UI test target sources.

### RunClub (app root)
- `ALGORITHM_SPEC.md`: Specification for the run generation logic.
- `MASTER_PLAN.md`: Roadmap and planning notes.
- `Assets.xcassets/`: Shared image assets used across the app.

#### RunClub/RunClub (app target)
- `Assets.xcassets/`: App-target assets (accent/app icon variants).
- `Info.plist`: App configuration (bundle ID, permissions, URL schemes).
- `RootView.swift`: Top-level router that decides which screen to show (auth/onboarding/home) and wires background jobs.
- `RunClub.entitlements`: App entitlements.
- `RunClubApp.swift`: App entry point (`@main`).
- `Resources/`
  - `Fonts/`: Custom fonts bundled with the app.
  - `MatrixReports/…csv`: Dev report generated by the generator matrix runner.
  - `umbrella_genre_mapping.json`: Mapping of granular genres to umbrella categories.
  - `Video/backgroundrun.mp4`: Background video used by the UI.
- `Support/`
  - `Buttons.swift`: Reusable button styles/components.
  - `Config.swift`: Static configuration constants.
  - `Fonts.swift`: Typeface helpers.
  - `Keychain.swift`: Secure storage helpers.
  - `VideoBackgroundView.swift`: SwiftUI video background view.

### Core
#### RunClub/Core/Models
- `CachedModels.swift`: SwiftData entities and cache models.
- `CompletedRun.swift`: Completed run record (date, elapsedSeconds, distanceMeters, runMinutes, template).
- `PreviewRun.swift`: Preview data used to confirm a playlist before starting a run (includes `runMinutes`).
- `RunTemplateType.swift`: Templates (easyRun, strongSteady, waves, pyramid, kicker, rest).
- `Genre.swift`: Genres used for filtering and recommendations.
- `Decade.swift`: Decade buckets for filtering.
- `SpotifyCredentials.swift`: Stored credentials model (for legacy reads where applicable).

### Data (cross-feature infrastructure)
#### RunClub/Data/Library
- `LibraryCrawler.swift`: Crawls liked tracks to build local cache.
- `CrawlCoordinator.swift`: Orchestrates crawl lifecycle.
- `ProgressStores.swift`: Progress tracking for long-running jobs.

#### RunClub/Data/Recommendations
- `RecommendationsDataStack.swift`: Separate SwiftData store for recommendations.
- `RecommendationsCoordinator.swift`: Orchestrates recommendations population/refresh.
- `RecommendationsCrawler.swift`: Fetches recommendation candidates.
- `RecommendedSongsRepository.swift`: Repository for recommended tracks.

### Features (feature-first slices)
#### RunClub/Features/Auth
- `AuthService.swift`: Juky-first token flow (override tokens), keychain, and helpers.
- `WebTokenConnectView.swift`: WKWebView to gather tokens from Juky.
- `LoginSplashView.swift`: Splash/login with “Connect via Juky”.
- `JukyHeadlessRefresher.swift`: Headless token refresh helper (used by AuthService).

#### RunClub/Features/Home
- `HomeView.swift`: Main screen; template carousel, filters, minutes picker, CTA.
- `FilterPickerSheet.swift`: Sheet to select genres/decades.
- `DurationPickerSheet.swift`: Minutes wheel to select run length.
- `RunPreviewSheet.swift`: Preview of the generated playlist by segments.
- `NumberWheelPicker.swift`: Reusable number wheel component.
- `UIComponents.swift`: Home-specific UI primitives.
- `RunLogView.swift`: Simple log of completed runs with share.

#### RunClub/Features/RunSession
- `StartRunView.swift`: In-run UI; controls, now-playing card, phase cues.
- `RunSummaryView.swift`: Post-run summary (template, minutes, elapsed, distance).
- `RunSessionManager.swift`: CoreLocation-based run session manager (replaces HealthKit).
- `RunOrchestrator.swift`: Drives run phases and cue scheduling.
- `NotificationScheduler.swift`: Schedules local notifications for phase cues.
- `LiveActivityManager.swift`: Manages Live Activities during runs.
- `SpotifyPlaybackController.swift`: In-app playback controller.

#### RunClub/Features/Generation
- `LocalGenerator.swift`: Local generator; selects tracks and enforces minutes ±2m.
- `RunPreviewService.swift`: Builds `PreviewRun` for the preview sheet.
- `GeneratorUtils.swift`: Generator utilities and helpers.
- `GenreUmbrellaService.swift`: Umbrella-genre mapping logic.
- `SpotifyRecommendationService.swift`: Integration with Spotify recommendations.
- `GeneratorMatrixRunner.swift`: Dev tool to sweep templates × minutes.
- `ReccoBeatsService.swift`: External audio-features provider wrapper.

#### RunClub/Features/Settings
- `SettingsView.swift`: App settings; default run length (20–90 in 5-min increments), library/recs controls.

#### RunClub/Features/Onboarding
- `OnboardingFlowView.swift`: Single intro screen with “Get Started”.

### Services (cross-cutting integrations)
- `RunClub/Services/SpotifyService.swift`: Low-level Spotify Web API client and helpers.

### RunClub.xcodeproj
- `project.pbxproj`: Xcode project structure and build settings.
- `project.xcworkspace/`: Workspace metadata.
- `xcuserdata/`, `xcshareddata/`: Per-user and shared Xcode settings.

### Tests
- `RunClubTests/RunClubTests.swift`: Unit tests for core logic.
- `RunClubUITests/RunClubUITests.swift`: UI tests covering user flows.
- `RunClubUITests/RunClubUITestsLaunchTests.swift`: Launch test scaffolding.


